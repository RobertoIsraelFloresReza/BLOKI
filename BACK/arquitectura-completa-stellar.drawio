<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram name="C4 - Arquitectura Completa con Stellar" id="c4-stellar">
    <mxGraphModel dx="2500" dy="1500" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="4500" pageHeight="3000">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- ==================== LEVEL 1: SYSTEM CONTEXT ==================== -->
        <mxCell id="context_title" value="Level 1: System Context" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="20" width="400" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Users -->
        <mxCell id="user_juanito" value="Juanito&lt;br&gt;(Propietario)" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="70" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="user_fulano" value="Fulano&lt;br&gt;(Inversionista)" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="320" width="70" height="140" as="geometry"/>
        </mxCell>
        
        <!-- Main System -->
        <mxCell id="main_system" value="Sistema Tokenización&lt;br&gt;de Propiedades&lt;br&gt;&lt;br&gt;[Software System]&lt;br&gt;&lt;br&gt;Tokeniza propiedades,&lt;br&gt;marketplace, conversión fiat,&lt;br&gt;trading en DEX" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="340" y="140" width="280" height="200" as="geometry"/>
        </mxCell>
        
        <!-- External Systems -->
        <mxCell id="ext_stellar" value="Stellar Network&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;Blockchain, DEX,&lt;br&gt;Liquidity Pools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="100" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="ext_anchors" value="Stellar Anchors&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;Conversión MXN/USD&lt;br&gt;a stablecoins" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="260" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="ext_moneygram" value="MoneyGram Access&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;Cash in/out&lt;br&gt;vía Stellar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="100" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="ext_exchanges" value="CEX/DEX&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;Binance, Kraken,&lt;br&gt;StellarX" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="260" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="ext_registro" value="Registro Público&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;Verificación legal" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="340" y="420" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="ext_smartface" value="SmartFace&lt;br&gt;&lt;br&gt;[External System]&lt;br&gt;&lt;br&gt;KYC/Biometría" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="500" y="420" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Context Relations -->
        <mxCell id="crel_1" value="Tokeniza" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="user_juanito" target="main_system">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="crel_2" value="Invierte" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="user_fulano" target="main_system">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="crel_3" value="Emite tokens" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="main_system" target="ext_stellar">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="crel_4" value="Convierte fiat" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="main_system" target="ext_anchors">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="crel_5" value="Cash in/out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="main_system" target="ext_moneygram">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="crel_6" value="Liquidity" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=11;strokeWidth=2;" edge="1" parent="1" source="main_system" target="ext_exchanges">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- ==================== LEVEL 2: CONTAINERS ==================== -->
        <mxCell id="container_title" value="Level 2: Containers - Integración Stellar Completa" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="600" width="600" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Frontend -->
        <mxCell id="c_frontend" value="Frontend SPA&lt;br&gt;&lt;br&gt;[Container: React]&lt;br&gt;&lt;br&gt;UI tokenización,&lt;br&gt;trading, conversión" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="680" width="220" height="160" as="geometry"/>
        </mxCell>
        
        <!-- Backend -->
        <mxCell id="c_backend" value="Backend API&lt;br&gt;&lt;br&gt;[Container: NestJS]&lt;br&gt;&lt;br&gt;Business logic,&lt;br&gt;verificación, orquestación" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="360" y="680" width="220" height="160" as="geometry"/>
        </mxCell>
        
        <!-- Smart Contracts -->
        <mxCell id="c_contracts" value="Smart Contracts&lt;br&gt;&lt;br&gt;[Container: Soroban/Rust]&lt;br&gt;&lt;br&gt;Property tokens, marketplace,&lt;br&gt;escrow, ownership registry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="680" width="220" height="160" as="geometry"/>
        </mxCell>
        
        <!-- Stellar Integration Layer -->
        <mxCell id="c_stellar_layer" value="Stellar Integration&lt;br&gt;&lt;br&gt;[Container: Node.js]&lt;br&gt;&lt;br&gt;Asset issuance, DEX trading,&lt;br&gt;anchor integration, paths" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="920" y="680" width="220" height="160" as="geometry"/>
        </mxCell>
        
        <!-- Databases -->
        <mxCell id="c_postgres" value="PostgreSQL&lt;br&gt;&lt;br&gt;[Container: Database]&lt;br&gt;&lt;br&gt;Users, properties,&lt;br&gt;ownership %, txs" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="240" y="900" width="140" height="140" as="geometry"/>
        </mxCell>
        
        <mxCell id="c_redis" value="Redis&lt;br&gt;&lt;br&gt;[Container: Cache]&lt;br&gt;&lt;br&gt;Price cache,&lt;br&gt;jobs queue" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#1ba1e2;strokeColor=#006EAF;fontColor=#ffffff;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="420" y="900" width="140" height="140" as="geometry"/>
        </mxCell>
        
        <!-- Stellar Network Detail -->
        <mxCell id="stellar_detail" value="Stellar Network" style="swimlane;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1200" y="680" width="900" height="580" as="geometry"/>
        </mxCell>
        
        <!-- Horizon API -->
        <mxCell id="stellar_horizon" value="Horizon API&lt;br&gt;&lt;br&gt;[Component]&lt;br&gt;&lt;br&gt;REST API Stellar&lt;br&gt;Ledger, accounts, txs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="30" y="50" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Soroban RPC -->
        <mxCell id="stellar_soroban_rpc" value="Soroban RPC&lt;br&gt;&lt;br&gt;[Component]&lt;br&gt;&lt;br&gt;Smart contract calls&lt;br&gt;State queries" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="220" y="50" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Stellar DEX -->
        <mxCell id="stellar_dex" value="Stellar DEX&lt;br&gt;&lt;br&gt;[Component]&lt;br&gt;&lt;br&gt;Orderbook trading&lt;br&gt;Property tokens &lt;-&gt; USDC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="410" y="50" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Liquidity Pools -->
        <mxCell id="stellar_pools" value="Liquidity Pools&lt;br&gt;&lt;br&gt;[Component]&lt;br&gt;&lt;br&gt;AMM pools para&lt;br&gt;property tokens" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="600" y="50" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Anchors Detail -->
        <mxCell id="anchors_layer" value="Anchors (Fiat Gateway)" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="30" y="180" width="830" height="180" as="geometry"/>
        </mxCell>
        
        <mxCell id="anchor_mxn" value="MXN Anchor&lt;br&gt;&lt;br&gt;[Anchor]&lt;br&gt;&lt;br&gt;Bitso/Stellar MXN&lt;br&gt;Depositar/Retirar MXN" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="anchors_layer">
          <mxGeometry x="20" y="40" width="120" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="anchor_usdc" value="USDC Anchor&lt;br&gt;&lt;br&gt;[Anchor]&lt;br&gt;&lt;br&gt;Circle USDC&lt;br&gt;on Stellar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="anchors_layer">
          <mxGeometry x="160" y="40" width="120" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="anchor_moneygram" value="MoneyGram&lt;br&gt;&lt;br&gt;[Anchor]&lt;br&gt;&lt;br&gt;Cash pickup/deposit&lt;br&gt;Sin cuenta bancaria" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="anchors_layer">
          <mxGeometry x="300" y="40" width="120" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="anchor_bank" value="Bank Anchor&lt;br&gt;&lt;br&gt;[Anchor]&lt;br&gt;&lt;br&gt;SPEI transfers&lt;br&gt;Wire transfers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="anchors_layer">
          <mxGeometry x="440" y="40" width="120" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="anchor_bridge" value="Cross-Chain Bridge&lt;br&gt;&lt;br&gt;[Bridge]&lt;br&gt;&lt;br&gt;Ethereum &lt;-&gt; Stellar&lt;br&gt;Polygon &lt;-&gt; Stellar" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;" vertex="1" parent="anchors_layer">
          <mxGeometry x="580" y="40" width="120" height="120" as="geometry"/>
        </mxCell>
        
        <!-- Asset Management -->
        <mxCell id="asset_layer" value="Asset Management" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_detail">
          <mxGeometry x="30" y="390" width="830" height="170" as="geometry"/>
        </mxCell>
        
        <mxCell id="asset_property" value="Property Assets&lt;br&gt;&lt;br&gt;[Asset Type]&lt;br&gt;&lt;br&gt;PROP_JUANITO_CASA001&lt;br&gt;Issuer: Platform&lt;br&gt;Supply: 100 tokens (100%)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;" vertex="1" parent="asset_layer">
          <mxGeometry x="20" y="40" width="150" height="110" as="geometry"/>
        </mxCell>
        
        <mxCell id="asset_fraction" value="Fractional Tracking&lt;br&gt;&lt;br&gt;[Component]&lt;br&gt;&lt;br&gt;Usuario A: 25%&lt;br&gt;Usuario B: 30%&lt;br&gt;Usuario C: 20%&lt;br&gt;Disponible: 25%" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="asset_layer">
          <mxGeometry x="190" y="40" width="140" height="110" as="geometry"/>
        </mxCell>
        
        <mxCell id="asset_trustline" value="Trustlines&lt;br&gt;&lt;br&gt;[Mechanism]&lt;br&gt;&lt;br&gt;Users must trust&lt;br&gt;property asset&lt;br&gt;before receiving" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="asset_layer">
          <mxGeometry x="350" y="40" width="140" height="110" as="geometry"/>
        </mxCell>
        
        <mxCell id="asset_claimable" value="Claimable Balances&lt;br&gt;&lt;br&gt;[Feature]&lt;br&gt;&lt;br&gt;Tokens pendientes&lt;br&gt;por reclamar&lt;br&gt;después de compra" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="asset_layer">
          <mxGeometry x="510" y="40" width="140" height="110" as="geometry"/>
        </mxCell>
        
        <mxCell id="asset_path" value="Path Payments&lt;br&gt;&lt;br&gt;[Feature]&lt;br&gt;&lt;br&gt;MXN → USDC → PROP&lt;br&gt;Conversión automática&lt;br&gt;Best rate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;" vertex="1" parent="asset_layer">
          <mxGeometry x="670" y="40" width="140" height="110" as="geometry"/>
        </mxCell>
        
        <!-- Container Relations -->
        <mxCell id="cont_rel_1" value="HTTPS/JSON" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_frontend" target="c_backend">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="cont_rel_2" value="Deploy/Invoke" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_backend" target="c_contracts">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="cont_rel_3" value="SDK calls" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_backend" target="c_stellar_layer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="cont_rel_4" value="RPC" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_contracts" target="stellar_soroban_rpc">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="860" y="760" as="sourcePoint"/>
            <mxPoint x="1200" y="780" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cont_rel_5" value="Horizon API" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_stellar_layer" target="stellar_horizon">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="cont_rel_6" value="SQL" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=10;strokeWidth=2;" edge="1" parent="1" source="c_backend" target="c_postgres">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- ==================== LEVEL 3: DETAILED COMPONENTS ==================== -->
        <mxCell id="detailed_title" value="Level 3: Stellar Integration Services Detail" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="1320" width="600" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Stellar Integration Services -->
        <mxCell id="stellar_services" value="Stellar Integration Layer - Services" style="swimlane;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="60" y="1400" width="2000" height="400" as="geometry"/>
        </mxCell>
        
        <!-- Asset Service -->
        <mxCell id="svc_asset" value="AssetIssuanceService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="30" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_asset_1" value="createPropertyAsset()&lt;br&gt;- Define asset code&lt;br&gt;- Set issuer account&lt;br&gt;- Configure supply" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;align=left;" vertex="1" parent="svc_asset">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_asset_2" value="mintTokens(property, amount)&lt;br&gt;- Mint fractional tokens&lt;br&gt;- Track % ownership&lt;br&gt;- Update registry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;align=left;" vertex="1" parent="svc_asset">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_asset_3" value="lockSupply()&lt;br&gt;- Prevent additional minting&lt;br&gt;- Set max supply&lt;br&gt;- Immutable cap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;align=left;" vertex="1" parent="svc_asset">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_asset_4" value="trackOwnership()&lt;br&gt;- Query holder balances&lt;br&gt;- Calculate % owned&lt;br&gt;- Update DB snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;align=left;" vertex="1" parent="svc_asset">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- DEX Service -->
        <mxCell id="svc_dex" value="DEXTradingService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="340" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_dex_1" value="createOffer(sell, buy, price)&lt;br&gt;- List property tokens&lt;br&gt;- Set ask price in USDC&lt;br&gt;- Orderbook entry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_dex">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_dex_2" value="executeTrade(offerId)&lt;br&gt;- Match buyer/seller&lt;br&gt;- Atomic swap&lt;br&gt;- Update balances" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_dex">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_dex_3" value="getOrderbook(asset)&lt;br&gt;- Fetch buy/sell orders&lt;br&gt;- Calculate mid price&lt;br&gt;- Spread analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_dex">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_dex_4" value="cancelOffer(offerId)&lt;br&gt;- Remove from orderbook&lt;br&gt;- Return funds to user" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_dex">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Anchor Service -->
        <mxCell id="svc_anchor" value="AnchorIntegrationService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="650" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_anchor_1" value="depositFiat(amount, currency)&lt;br&gt;- SEP-24 deposit flow&lt;br&gt;- MXN → MXN token&lt;br&gt;- USD → USDC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;align=left;" vertex="1" parent="svc_anchor">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_anchor_2" value="withdrawFiat(amount)&lt;br&gt;- Burn stable tokens&lt;br&gt;- Bank transfer/cash pickup&lt;br&gt;- SEP-24 withdrawal" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;align=left;" vertex="1" parent="svc_anchor">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_anchor_3" value="moneygramCashout(user)&lt;br&gt;- MoneyGram Access API&lt;br&gt;- Generate pickup code&lt;br&gt;- No bank account needed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;align=left;" vertex="1" parent="svc_anchor">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_anchor_4" value="kycVerification(user)&lt;br&gt;- SEP-12 KYC&lt;br&gt;- Anchor compliance&lt;br&gt;- Approve for deposits" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;align=left;" vertex="1" parent="svc_anchor">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Path Payment Service -->
        <mxCell id="svc_path" value="PathPaymentService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="960" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_path_1" value="findBestPath(from, to, amount)&lt;br&gt;- Stellar path finding&lt;br&gt;- Multi-hop conversion&lt;br&gt;- Best exchange rate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;align=left;" vertex="1" parent="svc_path">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_path_2" value="executePathPayment()&lt;br&gt;- MXN → USDC → PROP&lt;br&gt;- Atomic multi-asset swap&lt;br&gt;- Slippage protection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;align=left;" vertex="1" parent="svc_path">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_path_3" value="calculateFees(path)&lt;br&gt;- Network fee (0.00001 XLM)&lt;br&gt;- DEX spread&lt;br&gt;- Anchor fees" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;align=left;" vertex="1" parent="svc_path">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_path_4" value="estimateReceived(amount)&lt;br&gt;- Preview conversion&lt;br&gt;- Show user final amount&lt;br&gt;- Before tx submission" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;align=left;" vertex="1" parent="svc_path">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Liquidity Service -->
        <mxCell id="svc_liquidity" value="LiquidityPoolService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="1270" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_liq_1" value="createPool(assetA, assetB)&lt;br&gt;- PROP/USDC pool&lt;br&gt;- Constant product AMM&lt;br&gt;- Set fee tier" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_liquidity">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_liq_2" value="addLiquidity(pool, amounts)&lt;br&gt;- Deposit PROP + USDC&lt;br&gt;- Receive LP tokens&lt;br&gt;- Earn trading fees" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_liquidity">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_liq_3" value="removeLiquidity(lpTokens)&lt;br&gt;- Burn LP tokens&lt;br&gt;- Receive assets back&lt;br&gt;- Include earned fees" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_liquidity">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_liq_4" value="swapViaPool(pool, amount)&lt;br&gt;- Trade against pool reserves&lt;br&gt;- Auto price discovery&lt;br&gt;- 0.3% fee to LPs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="svc_liquidity">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- Exchange Integration -->
        <mxCell id="svc_exchange" value="ExchangeIntegrationService" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="stellar_services">
          <mxGeometry x="1580" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_ex_1" value="listOnStellarX(property)&lt;br&gt;- Create trading pair&lt;br&gt;- Initial liquidity&lt;br&gt;- Price discovery" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;align=left;" vertex="1" parent="svc_exchange">
          <mxGeometry x="15" y="35" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_ex_2" value="fetchMarketData()&lt;br&gt;- Real-time prices&lt;br&gt;- 24h volume&lt;br&gt;- Price history" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;align=left;" vertex="1" parent="svc_exchange">
          <mxGeometry x="15" y="105" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_ex_3" value="aggregateLiquidity()&lt;br&gt;- Check multiple DEXs&lt;br&gt;- Best execution price&lt;br&gt;- Split orders" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;align=left;" vertex="1" parent="svc_exchange">
          <mxGeometry x="15" y="175" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <mxCell id="svc_ex_4" value="arbitrageDetection()&lt;br&gt;- Monitor price differences&lt;br&gt;- Alert opportunities&lt;br&gt;- Auto-balancing pools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;align=left;" vertex="1" parent="svc_exchange">
          <mxGeometry x="15" y="245" width="250" height="60" as="geometry"/>
        </mxCell>
        
        <!-- ==================== SMART CONTRACTS DETAIL ==================== -->
        <mxCell id="contracts_title" value="Level 3: Smart Contracts Detail (Soroban)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="2200" y="1320" width="500" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="contracts_detail" value="Soroban Smart Contracts" style="swimlane;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="2200" y="1400" width="1180" height="400" as="geometry"/>
        </mxCell>
        
        <!-- Property Token Contract -->
        <mxCell id="ct_property" value="PropertyTokenContract" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="contracts_detail">
          <mxGeometry x="30" y="50" width="260" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_1" value="initialize(property_id, total_supply)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="30" width="240" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_2" value="mint(to, amount, percentage)&lt;br&gt;Track fractional ownership %" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="70" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_3" value="transfer(from, to, amount)&lt;br&gt;Update ownership registry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="120" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_4" value="balance_of(owner)&lt;br&gt;Query token balance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="170" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_5" value="get_ownership_percentage(owner)&lt;br&gt;Calculate % of total supply" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="220" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_prop_6" value="list_all_owners()&lt;br&gt;Return all token holders + %" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=8;align=left;" vertex="1" parent="ct_property">
          <mxGeometry x="10" y="270" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Marketplace Contract -->
        <mxCell id="ct_market" value="MarketplaceContract" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="contracts_detail">
          <mxGeometry x="310" y="50" width="260" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_1" value="list_property(token, amount, price_usdc)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="30" width="240" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_2" value="buy_tokens(listing_id, amount)&lt;br&gt;Call escrow, transfer tokens" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="70" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_3" value="cancel_listing(listing_id)&lt;br&gt;Return tokens to seller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="120" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_4" value="get_listings(property_id)&lt;br&gt;Active sell orders" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="170" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_5" value="get_price_history(property_id)&lt;br&gt;Historical trades, volume" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="220" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_mkt_6" value="calculate_market_cap()&lt;br&gt;Total value of all properties" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=8;align=left;" vertex="1" parent="ct_market">
          <mxGeometry x="10" y="270" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Escrow Contract -->
        <mxCell id="ct_escrow" value="EscrowContract" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="contracts_detail">
          <mxGeometry x="590" y="50" width="260" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_esc_1" value="lock_funds(buyer, amount_usdc)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;align=left;" vertex="1" parent="ct_escrow">
          <mxGeometry x="10" y="30" width="240" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_esc_2" value="release_to_seller(listing_id)&lt;br&gt;After token transfer confirmed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;align=left;" vertex="1" parent="ct_escrow">
          <mxGeometry x="10" y="70" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_esc_3" value="refund_to_buyer(listing_id)&lt;br&gt;If trade fails/disputed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;align=left;" vertex="1" parent="ct_escrow">
          <mxGeometry x="10" y="120" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_esc_4" value="get_escrow_status(tx_id)&lt;br&gt;Locked, Released, Refunded" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;align=left;" vertex="1" parent="ct_escrow">
          <mxGeometry x="10" y="170" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_esc_5" value="set_timeout(duration)&lt;br&gt;Auto-refund after X time" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=8;align=left;" vertex="1" parent="ct_escrow">
          <mxGeometry x="10" y="220" width="240" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Registry Contract -->
        <mxCell id="ct_registry" value="OwnershipRegistryContract" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1" vertex="1" parent="contracts_detail">
          <mxGeometry x="870" y="50" width="280" height="320" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_1" value="register_property(id, owner, metadata)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="30" width="260" height="30" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_2" value="update_ownership(property, new_holders[])&lt;br&gt;Track fractional owners + %" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="70" width="260" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_3" value="verify_ownership(property, user)&lt;br&gt;Returns boolean + percentage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="120" width="260" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_4" value="get_property_owners(property_id)&lt;br&gt;List of all partial owners" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="170" width="260" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_5" value="record_legal_document(property, hash)&lt;br&gt;Store notary certification" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="220" width="260" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="ct_reg_6" value="get_property_history(property_id)&lt;br&gt;All ownership changes over time" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=8;align=left;" vertex="1" parent="ct_registry">
          <mxGeometry x="10" y="270" width="260" height="40" as="geometry"/>
        </mxCell>
        
        <!-- ==================== FLOW EXAMPLES ==================== -->
        <mxCell id="flow_title" value="Flujos de Usuario Ejemplo" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="60" y="1860" width="400" height="40" as="geometry"/>
        </mxCell>
        
        <!-- Flow 1: Tokenization -->
        <mxCell id="flow1" value="Flujo 1: Tokenización (Juanito)" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="1920" width="1000" height="280" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step1" value="1. Subir INE + SmartFace" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="20" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step2" value="2. Backend verifica con&lt;br&gt;Registro Público" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="220" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step3" value="3. Crear PropertyAsset&lt;br&gt;en Stellar (100 tokens)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="420" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step4" value="4. Deploy PropertyToken&lt;br&gt;Soroban contract" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="620" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step5" value="5. Mint 100 tokens&lt;br&gt;to Juanito (100% ownership)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="820" y="40" width="160" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step6" value="6. Register en OwnershipRegistry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="220" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step7" value="7. List 25 tokens en&lt;br&gt;Marketplace ($500k USDC)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="420" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_step8" value="8. Create liquidity pool&lt;br&gt;PROP/USDC en DEX" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="flow1">
          <mxGeometry x="620" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_arrow1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow1" source="flow1_step1" target="flow1_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_arrow2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow1" source="flow1_step2" target="flow1_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_arrow3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow1" source="flow1_step3" target="flow1_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow1_arrow4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow1" source="flow1_step4" target="flow1_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- Flow 2: Purchase -->
        <mxCell id="flow2" value="Flujo 2: Compra con Conversión (Fulano)" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1920" width="1000" height="280" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step1" value="1. Fulano deposita&lt;br&gt;$10,000 MXN en banco" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="20" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step2" value="2. Anchor convierte&lt;br&gt;MXN → MXN tokens (Stellar)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="220" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step3" value="3. Path payment:&lt;br&gt;MXN → USDC → PROP" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="420" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step4" value="4. Lock $500 USDC&lt;br&gt;en Escrow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="620" y="40" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step5" value="5. Transfer 10 tokens&lt;br&gt;Juanito → Fulano (10%)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="820" y="40" width="160" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step6" value="6. Release USDC to Juanito" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="220" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step7" value="7. Update OwnershipRegistry&lt;br&gt;Juanito: 90%, Fulano: 10%" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="420" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_step8" value="8. Si quiere, Fulano retira&lt;br&gt;ganancias vía MoneyGram" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="flow2">
          <mxGeometry x="620" y="120" width="180" height="50" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_arrow1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow2" source="flow2_step1" target="flow2_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_arrow2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow2" source="flow2_step2" target="flow2_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_arrow3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow2" source="flow2_step3" target="flow2_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="flow2_arrow4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="flow2" source="flow2_step4" target="flow2_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
